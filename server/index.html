<!DOCTYPE html>
<html>

<head>
    <title>Camera Logs</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"
        integrity="sha384-LtrjvnR4Twt/qOuYxE721u19sVFLVSA4hf/rRt6PrZTmiPltdZcI7q7PXQBYTKyf" crossorigin="anonymous">
    </script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

</head>

<style>
    .container {
        position: relative;
        margin-top: 1rem;
    }

    .btn-refresh {
        position: absolute;
        right: 15px;
        top: 0px;
    }

    .card-body {
        padding: 0px;
    }

    .table {
        margin: 0px;
        text-align: left;
    }
</style>

<body>
    <div class="container">
        <h2>My Cameras</h2>
        <a href="#" class="btn btn-primary btn-refresh">Refresh All</a>

        <div id='log-container'></div>
    </div>

</body>

<script>
    function refreshLogs() {
        $.get('/update').then((response) => {
            console.log(response)
        }).catch((err)=>{
            console.log(err)
        })
    }

    function getLogs() {
        $.get('/logs').then((response) => {
            console.log(response)
            parseLogsToComponent(response);
        }).catch((err)=>{
            console.log(err)
        })
    }

    function parseLogsToComponent(_data) {
        let html = '';

        for (key in _data){
            html += makeCard(_data[key]);
        }

        $('#log-container').html(html);
    }




    function getDateTimeString(_unixTime){
        return `${new Date(_unixTime).toLocaleDateString("en-US")} at ${new Date(_unixTime).toLocaleTimeString("en-US")}`
    }

    function getFormattedLogs(_logs){

        let tableBody =''
        for (let index in _logs){
            tableBody += `<tr><td><span style="color:green;"><b>22223</b></span></td><td>test message</td></tr>`;
        }


        let html = `
            <table class="table table-borderless table-hover table-dark table-responsive">
                <tbody>
                ${tableBody}
                </tbody>
            </table>`


        return html;
    }

    function makeCard(_data) {
        console.log(_data)

        let logHtml = getFormattedLogs(_data)


        let html = `
            <br><div class="card text-center">
                <div class="card-header">${_data.metadata.name}</div>
                <div class="card-body">
                    ${logHtml}
                </div>
                <div class="card-footer text-muted">Last updated on ${getDateTimeString(_data.metadata.updated_at)}</div>
            </div>`

        return html;
    }


    $(function () {
        console.log("Page Initialized");


        getLogs();
        refreshLogs();
        getLogs();


    });
</script>



</html>